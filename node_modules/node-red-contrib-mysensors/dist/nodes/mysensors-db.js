"use strict";
const path_1 = require("path");
const database_sqlite_1 = require("../lib/database-sqlite");
module.exports = (RED) => {
    RED.nodes.registerType('mysensorsdb', function MysensorsDb(props) {
        const config = props;
        RED.nodes.createNode(this, config);
        this.file = config.file;
        try {
            if (this.file) {
                this.database = new database_sqlite_1.DatabaseSqlite(this.file);
            }
        }
        catch (error) {
            if (error.code === 'SQLITE_CANTOPEN') {
                this.error(`${error.name}: ${error.message} ${path_1.resolve(config.file || '')}`);
                return;
            }
            throw error;
        }
        this.on('close', () => {
            this.database.close();
        });
    });
};
