"use strict";
const mysensors_mqtt_1 = require("../lib/decoder/mysensors-mqtt");
const mysensors_serial_1 = require("../lib/decoder/mysensors-serial");
module.exports = (RED) => {
    RED.nodes.registerType('mysencode', function (props) {
        const config = props;
        RED.nodes.createNode(this, config);
        if (config.mqtt) {
            this.decoder = new mysensors_mqtt_1.MysensorsMqtt();
        }
        else {
            this.decoder = new mysensors_serial_1.MysensorsSerial();
        }
        this.on('input', (msg) => {
            if (config.mqtttopic !== '') {
                msg.topicRoot = config.mqtttopic;
            }
            this.send(this.decoder.encode(msg));
        });
    });
};
